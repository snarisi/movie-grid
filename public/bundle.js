'use strict';

angular.module('movieGrid', ['ui.router']).config(function ($urlRouterProvider, $locationProvider) {
	$locationProvider.html5Mode(true);
	$urlRouterProvider.otherwise('/movies/1');
});

'use strict';

angular.module('movieGrid').controller('MoviesCtrl', function ($scope, movies) {
	$scope.movies = movies.results;
	$scope.page = movies.page;
	$scope.totalPages = movies.total_pages;

	$scope.posterUrl = function (path) {
		return 'http://image.tmdb.org/t/p/w185' + path;
	};

	console.log(movies);
});

'use strict';

angular.module('movieGrid').factory('Movies', function ($http, $q) {
	var factory = {};
	var pageCache = {};
	var MAX_AGE = 36000000;

	var checkCache = function checkCache(page) {
		return pageCache[page] && Date.now() - pageCache[page].time <= MAX_AGE;
	};
	factory.getPage = function (page) {
		if (checkCache(page)) return $q.when(pageCache[page].data);

		return $http.get('/api/movies/' + page).then(function (res) {
			pageCache[page] = { data: res.data, time: Date.now() };
			return res.data;
		});
	};

	return factory;
});

angular.module('movieGrid').config(function ($stateProvider) {
	$stateProvider.state('movies', {
		url: '/movies/:page',
		controller: 'MoviesCtrl',
		templateUrl: 'movies/movies.html',
		resolve: {
			movies: function movies(Movies, $stateParams) {
				return Movies.getPage($stateParams.page);
			}
		}
	});
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJtb3ZpZXMvbW92aWVzLmNvbnRyb2xsZXIuanMiLCJtb3ZpZXMvbW92aWVzLmZhY3RvcnkuanMiLCJtb3ZpZXMvbW92aWVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsUUFBQSxNQUFBLENBQUEsV0FBQSxFQUFBLENBQUEsV0FBQSxDQUFBLEVBQ0EsTUFEQSxDQUNBLFVBQUEsa0JBQUEsRUFBQSxpQkFBQSxFQUFBO0FBQ0EsbUJBQUEsU0FBQSxDQUFBLElBQUE7QUFDQSxvQkFBQSxTQUFBLENBQUEsV0FBQTtBQUNBLENBSkE7O0FDQUE7O0FBRUEsUUFBQSxNQUFBLENBQUEsV0FBQSxFQUFBLFVBQUEsQ0FBQSxZQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsTUFBQSxFQUFBO0FBQ0EsUUFBQSxNQUFBLEdBQUEsT0FBQSxPQUFBO0FBQ0EsUUFBQSxJQUFBLEdBQUEsT0FBQSxJQUFBO0FBQ0EsUUFBQSxVQUFBLEdBQUEsT0FBQSxXQUFBOztBQUVBLFFBQUEsU0FBQSxHQUFBLFVBQUEsSUFBQSxFQUFBO0FBQ0EsNENBQUEsSUFBQTtBQUNBLEVBRkE7O0FBSUEsU0FBQSxHQUFBLENBQUEsTUFBQTtBQUNBLENBVkE7O0FDRkE7O0FBRUEsUUFBQSxNQUFBLENBQUEsV0FBQSxFQUFBLE9BQUEsQ0FBQSxRQUFBLEVBQUEsVUFBQSxLQUFBLEVBQUEsRUFBQSxFQUFBO0FBQ0EsS0FBQSxVQUFBLEVBQUE7QUFDQSxLQUFBLFlBQUEsRUFBQTtBQUNBLEtBQUEsVUFBQSxRQUFBOztBQUVBLEtBQUEsYUFBQSxTQUFBLFVBQUEsQ0FBQSxJQUFBLEVBQUE7QUFDQSxTQUFBLFVBQUEsSUFBQSxLQUFBLEtBQUEsR0FBQSxLQUFBLFVBQUEsSUFBQSxFQUFBLElBQUEsSUFBQSxPQUFBO0FBQ0EsRUFGQTtBQUdBLFNBQUEsT0FBQSxHQUFBLFVBQUEsSUFBQSxFQUFBO0FBQ0EsTUFBQSxXQUFBLElBQUEsQ0FBQSxFQUFBLE9BQUEsR0FBQSxJQUFBLENBQUEsVUFBQSxJQUFBLEVBQUEsSUFBQSxDQUFBOztBQUVBLFNBQUEsTUFBQSxHQUFBLGtCQUFBLElBQUEsRUFDQSxJQURBLENBQ0EsZUFBQTtBQUNBLGFBQUEsSUFBQSxJQUFBLEVBQUEsTUFBQSxJQUFBLElBQUEsRUFBQSxNQUFBLEtBQUEsR0FBQSxFQUFBLEVBQUE7QUFDQSxVQUFBLElBQUEsSUFBQTtBQUNBLEdBSkEsQ0FBQTtBQUtBLEVBUkE7O0FBVUEsUUFBQSxPQUFBO0FBQ0EsQ0FuQkE7O0FDRkEsUUFBQSxNQUFBLENBQUEsV0FBQSxFQUFBLE1BQUEsQ0FBQSxVQUFBLGNBQUEsRUFBQTtBQUNBLGdCQUFBLEtBQUEsQ0FBQSxRQUFBLEVBQUE7QUFDQSxPQUFBLGVBREE7QUFFQSxjQUFBLFlBRkE7QUFHQSxlQUFBLG9CQUhBO0FBSUEsV0FBQTtBQUNBLFdBQUEsZ0JBQUEsTUFBQSxFQUFBLFlBQUEsRUFBQTtBQUNBLFdBQUEsT0FBQSxPQUFBLENBQUEsYUFBQSxJQUFBLENBQUE7QUFDQTtBQUhBO0FBSkEsRUFBQTtBQVVBLENBWEEiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ21vdmllR3JpZCcsIFsndWkucm91dGVyJ10pXG5cdC5jb25maWcoZnVuY3Rpb24gKCR1cmxSb3V0ZXJQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG4gICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL21vdmllcy8xJyk7XG5cdH0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnbW92aWVHcmlkJykuY29udHJvbGxlcignTW92aWVzQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsIG1vdmllcykge1xuXHQkc2NvcGUubW92aWVzID0gbW92aWVzLnJlc3VsdHM7XG5cdCRzY29wZS5wYWdlID0gbW92aWVzLnBhZ2U7XG5cdCRzY29wZS50b3RhbFBhZ2VzID0gbW92aWVzLnRvdGFsX3BhZ2VzO1xuXG5cdCRzY29wZS5wb3N0ZXJVcmwgPSBmdW5jdGlvbiAocGF0aCkge1xuXHRcdHJldHVybiBgaHR0cDovL2ltYWdlLnRtZGIub3JnL3QvcC93MTg1JHtwYXRofWA7XG5cdH1cblxuXHRjb25zb2xlLmxvZyhtb3ZpZXMpO1xufSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdtb3ZpZUdyaWQnKS5mYWN0b3J5KCdNb3ZpZXMnLCBmdW5jdGlvbiAoJGh0dHAsICRxKSB7XG5cdGNvbnN0IGZhY3RvcnkgPSB7fTtcblx0Y29uc3QgcGFnZUNhY2hlID0ge307XG5cdGNvbnN0IE1BWF9BR0UgPSAzNjAwMDAwMDtcblxuXHRjb25zdCBjaGVja0NhY2hlID0gZnVuY3Rpb24gKHBhZ2UpIHtcblx0XHRyZXR1cm4gcGFnZUNhY2hlW3BhZ2VdICYmIChEYXRlLm5vdygpIC0gcGFnZUNhY2hlW3BhZ2VdLnRpbWUpIDw9IE1BWF9BR0U7XG5cdH07XG5cdGZhY3RvcnkuZ2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlKSB7XG5cdFx0aWYgKGNoZWNrQ2FjaGUocGFnZSkpIHJldHVybiAkcS53aGVuKHBhZ2VDYWNoZVtwYWdlXS5kYXRhKTtcblxuXHRcdHJldHVybiAkaHR0cC5nZXQoYC9hcGkvbW92aWVzLyR7cGFnZX1gKVxuXHRcdFx0LnRoZW4ocmVzID0+IHtcblx0XHRcdFx0cGFnZUNhY2hlW3BhZ2VdID0geyBkYXRhOiByZXMuZGF0YSwgdGltZTogRGF0ZS5ub3coKSB9O1xuXHRcdFx0XHRyZXR1cm4gcmVzLmRhdGE7XG5cdFx0XHR9KTtcblx0fVxuXG5cdHJldHVybiBmYWN0b3J5O1xufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnbW92aWVHcmlkJykuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuXHQkc3RhdGVQcm92aWRlci5zdGF0ZSgnbW92aWVzJywge1xuXHRcdHVybDogJy9tb3ZpZXMvOnBhZ2UnLFxuXHRcdGNvbnRyb2xsZXI6ICdNb3ZpZXNDdHJsJyxcblx0XHR0ZW1wbGF0ZVVybDogJ21vdmllcy9tb3ZpZXMuaHRtbCcsXG5cdFx0cmVzb2x2ZToge1xuXHRcdFx0bW92aWVzOiBmdW5jdGlvbiAoTW92aWVzLCAkc3RhdGVQYXJhbXMpIHtcblx0XHRcdFx0cmV0dXJuIE1vdmllcy5nZXRQYWdlKCRzdGF0ZVBhcmFtcy5wYWdlKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pXG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
